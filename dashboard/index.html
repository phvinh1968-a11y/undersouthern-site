<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    
    <title>Portal Dashboard - Undersouthern</title>

    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/phvinh1968-a11y/my-images/main/logoblack.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --bg-audiosalad: #f4f7f9;
            --sidebar-navy: #1a2b3c;
            --border-light: #dce4ec;
            --text-main: #4a5568;
            --accent-gray: #334155;
            --link-blue: #007bff;
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg-audiosalad); color: var(--text-main); margin: 0; overflow: hidden; display: flex; height: 100vh; }

        /* --- SIDEBAR --- */
        .sidebar { width: 260px; background: #ffffff; border-right: 1px solid var(--border-light); display: flex; flex-direction: column; height: 100%; flex-shrink: 0; z-index: 1000; transition: transform 0.3s ease-in-out; }
        @media (max-width: 1024px) { .sidebar { position: fixed; left: 0; top: 0; transform: translateX(-100%); } .sidebar.open { transform: translateX(0); } }
        .sidebar-header { height: 72px; display: flex; align-items: center; padding: 0 24px; border-bottom: 1px solid var(--border-light); }
        .brand-name { font-weight: 800; font-size: 18px; letter-spacing: -0.02em; color: var(--sidebar-navy); }
        .nav-menu { flex: 1; padding: 24px 0; overflow-y: auto; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 24px; margin-bottom: 2px; font-size: 13px; font-weight: 600; color: #5a6a85; cursor: pointer; border-left: 4px solid transparent; user-select: none; }
        .nav-item i { width: 20px; text-align: center; font-size: 15px; opacity: 0.7; }
        .nav-item.active { background: #f1f5f9; color: var(--sidebar-navy); border-left: 4px solid var(--accent-gray); }

        .sidebar-footer { padding: 16px; border-top: 1px solid var(--border-light); background: #fff; }
        .btn-signout { width: 100%; display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 10px; font-size: 13px; font-weight: 700; color: #ef4444; background: #fef2f2; }

        /* --- MAIN CONTENT & FIXED HEADER --- */
        .main-content { flex: 1; display: flex; flex-direction: column; width: 100%; position: relative; overflow: hidden; }
        .content-header { height: 72px; background: #fff; border-bottom: 1px solid var(--border-light); display: flex; align-items: center; padding: 0 40px; flex-shrink: 0; position: sticky; top: 0; z-index: 50; }
        .scroll-container { flex: 1; overflow-y: auto; padding: 40px; }
        
        #mobile-toggle { display: none; font-size: 20px; color: var(--sidebar-navy); cursor: pointer; margin-right: 16px; width: 24px; text-align: center; }
        @media (max-width: 1024px) { #mobile-toggle { display: block; } .content-header { padding: 0 24px; } }

        /* Catalog Overview Box */
        .catalog-overview-container { margin-bottom: 48px; }
        .overview-title { font-size: 14px; font-weight: 700; color: var(--sidebar-navy); margin-bottom: 16px; }
        .overview-box { background: #fff; border: 1px solid var(--border-light); border-radius: 8px; display: flex; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .overview-item { flex: 1; padding: 24px 32px; border-right: 1px solid var(--border-light); display: flex; flex-direction: column; justify-content: space-between; }
        .overview-item:last-child { border-right: none; }
        .item-label { font-size: 11px; font-weight: 600; color: #94a3b8; margin-bottom: 8px; }
        .item-value { font-size: 32px; font-weight: 800; color: var(--sidebar-navy); line-height: 1; }

        /* Sections titles */
        .section-title { font-size: 15px; font-weight: 700; color: var(--sidebar-navy); margin-bottom: 24px; border-bottom: 1px solid #e2e8f0; padding-bottom: 12px; }
        .catalog-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-bottom: 56px; }
        .catalog-card { background: #fff; border-radius: 4px; overflow: hidden; border: 1px solid var(--border-light); }
        .artwork-box { width: 100%; aspect-ratio: 1/1; position: relative; background: #eee; }
        .artwork-box img { width: 100%; height: 100%; object-fit: cover; }
        .date-badge { position: absolute; top: 0; right: 0; background: #00a651; color: #fff; padding: 4px 8px; font-size: 10px; font-weight: 900; text-align: center; line-height: 1.1; }

        /* Table Section */
        .table-wrapper { background: #fff; border-radius: 8px; border: 1px solid var(--border-light); overflow-x: auto; margin-bottom: 40px; }
        table { width: 100%; border-collapse: collapse; min-width: 700px; }
        th { text-align: left; padding: 16px 24px; background: #fafbfc; font-size: 10px; font-weight: 700; color: #94a3b8; border-bottom: 1px solid var(--border-light); }
        td { padding: 16px 24px; font-size: 12px; color: var(--sidebar-navy); border-bottom: 1px solid #f1f5f9; }
        .row-art { width: 36px; height: 36px; border-radius: 4px; object-fit: cover; margin-right: 12px; display: inline-block; vertical-align: middle; }

        .empty-view { display: none; width: 100%; height: 80vh; border: 2px dashed #cbd5e1; border-radius: 12px; align-items: center; justify-content: center; color: #cbd5e1; }
        #sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 999; }
        #sidebar-overlay.active { display: block; }
    </style>
</head>
<body>

    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <aside class="sidebar" id="mainSidebar">
        <div class="sidebar-header"><span class="brand-name">Undersouthern</span></div>
        <nav class="nav-menu" id="sidebar-nav">
            <div class="nav-item active" data-tab="Dashboard" onclick="activateItem(this)"><i class="fa-solid fa-table-cells-large"></i> Dashboard</div>
            <div class="nav-item" data-tab="Catalog" onclick="activateItem(this)"><i class="fa-solid fa-list-ul"></i> Catalog</div>
            <div class="nav-item" data-tab="Ingestion" onclick="activateItem(this)"><i class="fa-solid fa-folder-plus"></i> Catalog Ingestion</div>
            <div class="nav-item" data-tab="Delivery" onclick="activateItem(this)"><i class="fa-solid fa-paper-plane"></i> Delivery</div>
            <div class="nav-item" data-tab="Analytics" onclick="activateItem(this)"><i class="fa-solid fa-chart-line"></i> Analytics</div>
            <div class="nav-item" data-tab="Reporting" onclick="activateItem(this)"><i class="fa-solid fa-chart-pie"></i> Reporting</div>
            <div class="nav-item" data-tab="Tools" onclick="activateItem(this)"><i class="fa-solid fa-wrench"></i> Tools</div>
            <div class="nav-item" data-tab="Access" onclick="activateItem(this)"><i class="fa-solid fa-user"></i> User Access</div>
        </nav>
        <div class="sidebar-footer">
            <button class="btn-signout" onclick="void(0)"><i class="fa-solid fa-arrow-right-from-bracket"></i><span>Sign out</span></button>
        </div>
    </aside>

    <main class="main-content">
        <header class="content-header">
            <i class="fa-solid fa-bars" id="mobile-toggle" onclick="toggleSidebar()"></i>
            <h2 id="current-view-title" class="text-base md:text-lg font-bold text-slate-800 tracking-tight">Dashboard</h2>
        </header>

        <div class="scroll-container">
            <div id="dashboard-content">
                <div class="catalog-overview-container">
                    <h3 class="overview-title">Catalog overview</h3>
                    <div class="overview-box">
                        <div class="overview-item">
                            <div><div class="item-label">Products</div><div id="count-total" class="item-value">--</div></div>
                        </div>
                        <div class="overview-item">
                            <div><div class="item-label">Incomplete products</div><div id="count-pending" class="item-value">--</div></div>
                        </div>
                    </div>
                </div>

                <h3 class="section-title">Recent releases</h3>
                <div class="catalog-grid" id="grid-render"></div>

                <h3 class="section-title">Recently created</h3>
                <div class="table-wrapper">
                    <table>
                        <thead><tr><th>Product</th><th>Artist</th><th>Label</th><th>UPC</th><th>Created</th></tr></thead>
                        <tbody id="table-render"></tbody>
                    </table>
                </div>
            </div>

            <div id="empty-content" class="empty-view">
                <div class="text-center">
                    <i class="fa-solid fa-cube text-4xl mb-4 opacity-10"></i>
                    <p class="text-[10px] font-black uppercase tracking-[0.2em] opacity-20">Secure Environment / No Content</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        const DB_URL = "https://undersouthern-system-default-rtdb.asia-southeast1.firebasedatabase.app/catalog.json";

        window.onload = () => { fetchNode(); };

        async function fetchNode() {
            try {
                const response = await fetch(DB_URL);
                const data = await response.json() || {};
                const list = Object.values(data);
                document.getElementById('count-total').innerText = list.length;
                document.getElementById('count-pending').innerText = list.filter(i => i.status === 'Pending').length;
                renderUI(list);
            } catch (e) { console.error("Sync Error"); }
        }

        function renderUI(items) {
            const grid = document.getElementById('grid-render');
            const table = document.getElementById('table-render');

            grid.innerHTML = items.slice(0, 4).map(item => `
                <div class="catalog-card">
                    <div class="artwork-box">
                        <img src="${item.artwork || 'https://via.placeholder.com/300'}" onerror="this.src='https://via.placeholder.com/300'">
                        <div class="date-badge">May<br>9</div>
                    </div>
                    <div class="p-5"><p class="text-[13px] font-bold text-slate-800 truncate leading-tight">${item.title || 'Untitled'}</p><p class="text-[11px] text-slate-400 mt-2 truncate">${item.artists?.join(', ') || 'Unknown'}</p></div>
                </div>
            `).join('');

            table.innerHTML = items.map(item => `
                <tr>
                    <td><img src="${item.artwork || 'https://via.placeholder.com/40'}" class="row-art"><strong>${item.title || 'Untitled'}</strong></td>
                    <td>${item.artists?.join(', ') || '-'}</td>
                    <td>${item.label || 'Undersouthern'}</td>
                    <td style="font-family:monospace; opacity:0.6">${item.upc || '-'}</td>
                    <td>${item.created_at || '-'}</td>
                </tr>
            `).join('');
        }

        function activateItem(el) {
            document.querySelector('.nav-item.active').classList.remove('active');
            el.classList.add('active');
            const tab = el.getAttribute('data-tab');
            document.getElementById('current-view-title').innerText = el.innerText.trim();

            if(tab === "Dashboard") {
                document.getElementById('dashboard-content').style.display = "block";
                document.getElementById('empty-content').style.display = "none";
            } else {
                document.getElementById('dashboard-content').style.display = "none";
                document.getElementById('empty-content').style.display = "flex";
            }
            if (window.innerWidth <= 1024) toggleSidebar();
        }

        function toggleSidebar() {
            document.getElementById('mainSidebar').classList.toggle('open');
            document.getElementById('sidebar-overlay').classList.toggle('active');
        }
    </script>
</body>
</html>
