<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<title>BGM Dashboard</title>

<script>
emailjs.init("76t6wZsNebhI-PqFv");

// Táº¡o máº­t kháº©u
function generatePassword(length = 12) {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%&*?";
  return Array.from({length},()=>chars[Math.floor(Math.random()*chars.length)]).join("");
}

// áº¨n/hiá»‡n page
function showPage(id){
  ["loginPage","createPage","mainDash"].forEach(p=>document.getElementById(p).style.display="none");
  document.getElementById(id).style.display="block";
}

// Táº¡o tÃ i khoáº£n
function createAccount(event){
  event.preventDefault();
  const name=document.getElementById("createName").value.trim();
  const email=document.getElementById("createEmail").value;
  const pass=generatePassword();

  if(!name) return alert("Vui lÃ²ng nháº­p há» tÃªn");

  const accounts=JSON.parse(localStorage.getItem("accounts")||"[]");
  if(accounts.some(a=>a.email===email)){
    alert("Email Ä‘Ã£ tá»“n táº¡i!");
    return showPage("loginPage");
  }

  emailjs.send("service_jau0xqb","template_bgmshorts",{
    user_name:name,
    user_email:email,
    user_password:pass
  })
  .then(()=>{
    accounts.push({name,email,password:pass});
    localStorage.setItem("accounts",JSON.stringify(accounts));
    alert("Táº¡o tÃ i khoáº£n thÃ nh cÃ´ng! Máº­t kháº©u Ä‘Ã£ gá»­i qua email.");
    showPage("loginPage");
  }).catch(()=>alert("Gá»­i email tháº¥t báº¡i!"));
}

// ÄÄƒng nháº­p
function login(event){
  event.preventDefault();
  const email=document.getElementById("loginEmail").value;
  const pass=document.getElementById("loginPassword").value;

  const accounts=JSON.parse(localStorage.getItem("accounts")||"[]");
  const acc=accounts.find(a=>a.email===email&&a.password===pass);

  if(!acc) return alert("Sai email hoáº·c máº­t kháº©u!");

  localStorage.setItem("logged",JSON.stringify(acc));
  loadDashboard();
}

// Load Dashboard Analytics
function loadDashboard(){
  const user=JSON.parse(localStorage.getItem("logged"));
  if(!user) return showPage("loginPage");

  document.getElementById("username").innerText=user.name;
  showPage("mainDash");

  const data={
    streams:1027798,
    downloads:0,
    creations:0,
    revenue:8.92,
    chartDates:["Nov 28","Nov 29","Nov 30","Dec 1","Dec 2","Dec 3"],
    chartNumbers:[400000,350000,20000,250000,100000,0]
  };

  document.getElementById("streams").innerText=data.streams.toLocaleString();
  document.getElementById("downloads").innerText=data.downloads;
  document.getElementById("creations").innerText=data.creations;
  document.getElementById("revenue").innerText=`â‚¬${data.revenue}`;

  new Chart(document.getElementById('donutChart'),{
    type:'doughnut',
    data:{labels:['Top Streams'],datasets:[{data:[data.streams],backgroundColor:['#3B82F6'],borderWidth:0}]},
    options:{cutout:'70%'}
  });

  new Chart(document.getElementById('lineChart'),{
    type:'line',
    data:{labels:data.chartDates,datasets:[{data:data.chartNumbers,borderColor:'#3B82F6',tension:.4}]}
  });

  document.getElementById("trackList").innerHTML=`
    <tr class="border-b">
      <td class="p-3">Rockabye</td>
      <td class="p-3">${data.streams.toLocaleString()}</td>
      <td class="p-3">${data.downloads}</td>
      <td class="p-3">${data.creations}</td>
      <td class="p-3">â‚¬${data.revenue}</td>
      <td class="p-3">100%</td>
    </tr>`;
}

function logout(){
  localStorage.removeItem("logged");
  showPage("loginPage");
}

window.onload=()=>localStorage.getItem("logged")?loadDashboard():showPage("loginPage");
</script>
</head>

<body class="bg-[#0F0F0F] min-h-screen flex justify-center items-center p-4">

<!-- LOGIN -->
<div id="loginPage" class="w-full max-w-md bg-[#1A1A1A] p-8 rounded-2xl hidden text-white">
<h1 class="text-3xl mb-5 text-center">BGM Login</h1>
<form onsubmit="login(event)" class="space-y-4">
<input id="loginEmail" type="email" required placeholder="Email" class="w-full p-3 rounded bg-[#2A2A2A]">
<input id="loginPassword" type="password" required placeholder="Password" class="w-full p-3 rounded bg-[#2A2A2A]">
<button class="w-full bg-blue-600 p-3 rounded">Login</button>
</form>
<p class="text-center mt-3">No account? <span onclick="showPage('createPage')" class="text-blue-400 cursor-pointer">Create</span></p>
</div>

<!-- CREATE ACCOUNT -->
<div id="createPage" class="w-full max-w-md bg-[#1A1A1A] p-8 rounded-2xl hidden text-white">
<h1 class="text-3xl mb-5 text-center">Create Account</h1>
<form onsubmit="createAccount(event)" class="space-y-4">
<input id="createName" required placeholder="Há» vÃ  TÃªn" class="w-full p-3 rounded bg-[#2A2A2A]">
<input id="createEmail" type="email" required placeholder="Email" class="w-full p-3 rounded bg-[#2A2A2A]">
<button class="w-full bg-green-600 p-3 rounded">Create</button>
</form>
<p class="text-center mt-3">Have account? <span onclick="showPage('loginPage')" class="text-blue-400 cursor-pointer">Login</span></p>
</div>

<!-- MAIN DASHBOARD -->
<div id="mainDash" class="hidden p-6 w-full min-h-screen bg-[#F5F7FB] overflow-y-auto">

<h1 class="text-2xl font-bold mb-4">Welcome, <span id="username"></span> ðŸ‘‹</h1>
<button onclick="logout()" class="mb-6 px-4 py-2 bg-red-600 text-white rounded">Logout</button>

<div class="flex flex-col md:flex-row md:justify-between gap-4 mb-6">
<button class="bg-blue-600 text-white px-4 py-2 rounded">Add Filter</button>
<input type="date" class="px-3 py-2 border rounded bg-white"/>
</div>

<!-- KPI -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
<div class="bg-white p-5 rounded shadow"><p class="text-gray-600">Streams</p><h1 id="streams" class="text-3xl font-bold">0</h1></div>
<div class="bg-white p-5 rounded shadow"><p class="text-gray-600">Downloads</p><h1 id="downloads" class="text-3xl font-bold">0</h1></div>
<div class="bg-white p-5 rounded shadow"><p class="text-gray-600">Creations</p><h1 id="creations" class="text-3xl font-bold">0</h1></div>
<div class="bg-white p-5 rounded shadow"><p class="text-gray-600">Revenue</p><h1 id="revenue" class="text-3xl font-bold text-green-600">â‚¬0.00</h1></div>
</div>

<!-- Chart -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="bg-white p-6 rounded shadow"><canvas id="donutChart"></canvas></div>
<div class="bg-white p-6 rounded shadow"><canvas id="lineChart"></canvas></div>
</div>

<!-- Table -->
<div class="bg-white mt-6 rounded shadow p-4 overflow-x-auto">
<table class="w-full text-left min-w-[600px]">
<thead><tr class="text-gray-500 border-b">
<th class="p-2">Title</th><th class="p-2">Streams</th><th class="p-2">Downloads</th><th class="p-2">Creations</th><th class="p-2">Revenue</th><th class="p-2">%</th>
</tr></thead>
<tbody id="trackList"></tbody>
</table>
</div>
</div>

</body>
</html>
