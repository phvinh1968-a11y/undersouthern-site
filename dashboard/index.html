<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    
    <title>Portal Dashboard - UNDERSOUTHERN</title>

    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/phvinh1968-a11y/my-images/main/logoblack.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --bg-audiosalad: #f4f7f9;
            --sidebar-navy: #1a2b3c;
            --border-light: #dce4ec;
            --text-main: #4a5568;
            --accent-gray: #334155;
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg-audiosalad); color: var(--text-main); margin: 0; overflow: hidden; display: flex; height: 100vh; }

        /* --- SIDEBAR --- */
        .sidebar { width: 260px; background: #ffffff; border-right: 1px solid var(--border-light); display: flex; flex-direction: column; height: 100%; flex-shrink: 0; z-index: 1000; transition: transform 0.3s ease-in-out; }
        @media (max-width: 1024px) { .sidebar { position: fixed; left: 0; top: 0; transform: translateX(-100%); } .sidebar.open { transform: translateX(0); } }
        .sidebar-header { height: 72px; display: flex; align-items: center; padding: 0 24px; border-bottom: 1px solid var(--border-light); }
        .brand-name { font-weight: 900; font-size: 18px; letter-spacing: -0.02em; color: var(--sidebar-navy); text-transform: uppercase; }
        .nav-menu { flex: 1; padding: 24px 0; overflow-y: auto; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 24px; margin-bottom: 2px; font-size: 13px; font-weight: 600; color: #5a6a85; cursor: pointer; border-left: 4px solid transparent; user-select: none; }
        .nav-item i { width: 20px; text-align: center; font-size: 15px; opacity: 0.7; }
        .nav-item.active { background: #f1f5f9; color: var(--sidebar-navy); border-left: 4px solid var(--accent-gray); }

        .sidebar-footer { padding: 16px; border-top: 1px solid var(--border-light); background: #fff; }
        .btn-signout { width: 100%; display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 10px; font-size: 13px; font-weight: 700; color: #ef4444; background: #fef2f2; text-transform: uppercase; letter-spacing: 0.05em; }

        /* --- MAIN CONTENT --- */
        .main-content { flex: 1; overflow-y: auto; background: var(--bg-audiosalad); display: flex; flex-direction: column; width: 100%; }
        .content-header { height: 72px; background: #fff; border-bottom: 1px solid var(--border-light); display: flex; align-items: center; padding: 0 24px; flex-shrink: 0; }
        #mobile-toggle { display: none; font-size: 20px; color: var(--sidebar-navy); cursor: pointer; margin-right: 16px; width: 24px; text-align: center; }
        @media (max-width: 1024px) { #mobile-toggle { display: block; } }

        .view-container { padding: 24px md:40px; flex: 1; }

        /* --- DASHBOARD UI ELEMENTS --- */
        .dashboard-content { display: block; }
        .other-content { display: none; width: 100%; height: 100%; border: 2px dashed #cbd5e1; border-radius: 12px; }

        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px; }
        .metric-card { background: #fff; padding: 24px; border-radius: 8px; border: 1px solid var(--border-light); }
        .metric-label { font-size: 10px; font-weight: 700; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em; }
        .metric-value { font-size: 32px; font-weight: 800; color: var(--sidebar-navy); margin-top: 8px; }

        .section-title { font-size: 14px; font-weight: 800; color: var(--sidebar-navy); text-transform: uppercase; margin-bottom: 20px; border-bottom: 1px solid #e2e8f0; padding-bottom: 8px; }
        
        .catalog-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .catalog-card { background: #fff; border-radius: 4px; overflow: hidden; border: 1px solid var(--border-light); }
        .artwork-box { width: 100%; aspect-ratio: 1/1; position: relative; background: #eee; }
        .artwork-box img { width: 100%; height: 100%; object-fit: cover; }
        .date-badge { position: absolute; top: 0; right: 0; background: #00a651; color: #fff; padding: 4px 8px; font-size: 9px; font-weight: 900; text-align: center; line-height: 1; text-transform: uppercase; }

        .table-wrapper { background: #fff; border-radius: 8px; border: 1px solid var(--border-light); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { text-align: left; padding: 12px 24px; background: #fafbfc; font-size: 10px; font-weight: 800; color: #94a3b8; text-transform: uppercase; border-bottom: 1px solid var(--border-light); }
        td { padding: 12px 24px; font-size: 12px; color: var(--sidebar-navy); border-bottom: 1px solid #f1f5f9; }
        .row-art { width: 32px; height: 32px; border-radius: 4px; object-fit: cover; margin-right: 12px; }

        #sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 999; }
        #sidebar-overlay.active { display: block; }
    </style>
</head>
<body>

    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <aside class="sidebar" id="mainSidebar">
        <div class="sidebar-header"><span class="brand-name">UNDERSOUTHERN</span></div>
        <nav class="nav-menu" id="sidebar-nav">
            <div class="nav-item active" data-tab="Dashboard" onclick="activateItem(this)">
                <i class="fa-solid fa-table-cells-large"></i> Dashboard
            </div>
            <div class="nav-item" data-tab="Catalog" onclick="activateItem(this)">
                <i class="fa-solid fa-list-ul"></i> Catalog
            </div>
            <div class="nav-item" data-tab="Ingestion" onclick="activateItem(this)">
                <i class="fa-solid fa-folder-plus"></i> Catalog Ingestion
            </div>
            <div class="nav-item" data-tab="Delivery" onclick="activateItem(this)">
                <i class="fa-solid fa-paper-plane"></i> Delivery
            </div>
            <div class="nav-item" data-tab="Analytics" onclick="activateItem(this)">
                <i class="fa-solid fa-chart-line"></i> Analytics
            </div>
            <div class="nav-item" data-tab="Reporting" onclick="activateItem(this)">
                <i class="fa-solid fa-chart-pie"></i> Reporting
            </div>
            <div class="nav-item" data-tab="Tools" onclick="activateItem(this)">
                <i class="fa-solid fa-wrench"></i> Tools
            </div>
            <div class="nav-item" data-tab="Access" onclick="activateItem(this)">
                <i class="fa-solid fa-user"></i> User Access
            </div>
        </nav>
        <div class="sidebar-footer">
            <button class="btn-signout" onclick="void(0)"><i class="fa-solid fa-arrow-right-from-bracket"></i><span>Sign Out</span></button>
        </div>
    </aside>

    <main class="main-content">
        <header class="content-header">
            <i class="fa-solid fa-bars" id="mobile-toggle" onclick="toggleSidebar()"></i>
            <h2 id="current-view-title" class="text-base md:text-lg font-bold text-slate-800 tracking-tight">Dashboard</h2>
        </header>

        <div class="view-container" id="content-area">
            <div id="dashboard-view" class="dashboard-content">
                <div class="metrics-grid">
                    <div class="metric-card"><div class="metric-label">Total Assets</div><div id="count-total" class="metric-value">--</div></div>
                    <div class="metric-card"><div class="metric-label">Reviewing</div><div id="count-pending" class="metric-value text-amber-500">--</div></div>
                    <div class="metric-card"><div class="metric-label">Live Releases</div><div id="count-live" class="metric-value text-emerald-600">--</div></div>
                </div>

                <h3 class="section-title">Recent Releases</h3>
                <div class="catalog-grid" id="recent-grid"></div>

                <h3 class="section-title">Recently Created</h3>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr><th>Product</th><th>Artist</th><th>Label</th><th>UPC</th><th>Created</th></tr>
                        </thead>
                        <tbody id="recent-table"></tbody>
                    </table>
                </div>
            </div>

            <div id="empty-view" class="other-content"></div>
        </div>
    </main>

    <script>
        const FB_DB = "https://undersouthern-system-default-rtdb.asia-southeast1.firebasedatabase.app/catalog.json";

        window.onload = () => { fetchNodeData(); };

        async function fetchNodeData() {
            try {
                const response = await fetch(FB_DB);
                const data = await response.json() || {};
                const list = Object.values(data);
                
                // Update Metrics
                document.getElementById('count-total').innerText = list.length;
                document.getElementById('count-pending').innerText = list.filter(i => i.status === 'Pending').length;
                document.getElementById('count-live').innerText = list.filter(i => i.status === 'Released').length;

                renderDashboard(list);
            } catch (e) { console.error("Node Sync Failure"); }
        }

        function renderDashboard(items) {
            const grid = document.getElementById('recent-grid');
            const table = document.getElementById('recent-table');

            // Grid (First 4 items)
            grid.innerHTML = items.slice(0, 4).map(item => `
                <div class="catalog-card">
                    <div class="artwork-box">
                        <img src="${item.artwork || 'https://via.placeholder.com/300'}" onerror="this.src='https://via.placeholder.com/300'">
                        <div class="date-badge">MAY<br>9</div>
                    </div>
                    <div class="p-4">
                        <p class="text-[13px] font-bold text-slate-800 truncate">${item.title || 'Untitled'}</p>
                        <p class="text-[11px] text-slate-400 truncate">${item.artists?.join(', ') || 'Unknown'}</p>
                    </div>
                </div>
            `).join('');

            // Table
            table.innerHTML = items.map(item => `
                <tr>
                    <td style="display:flex; align-items:center"><img src="${item.artwork || 'https://via.placeholder.com/40'}" class="row-art">${item.title || 'Untitled'}</td>
                    <td>${item.artists?.join(', ') || '-'}</td>
                    <td>${item.label || 'Undersouthern'}</td>
                    <td style="font-family:monospace; opacity:0.6">${item.upc || '-'}</td>
                    <td>${item.created_at || '-'}</td>
                </tr>
            `).join('');
        }

        function activateItem(element) {
            // UI Toggle
            document.querySelector('.nav-item.active').classList.remove('active');
            element.classList.add('active');
            
            const tabName = element.getAttribute('data-tab');
            document.getElementById('current-view-title').innerText = element.innerText.trim();

            // Content Logic: Only show content for Dashboard
            if(tabName === "Dashboard") {
                document.getElementById('dashboard-view').style.display = "block";
                document.getElementById('empty-view').style.display = "none";
            } else {
                document.getElementById('dashboard-view').style.display = "none";
                document.getElementById('empty-view').style.display = "flex";
            }

            if (window.innerWidth <= 1024) toggleSidebar();
        }

        function toggleSidebar() {
            document.getElementById('mainSidebar').classList.toggle('open');
            document.getElementById('sidebar-overlay').classList.toggle('active');
        }

        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
